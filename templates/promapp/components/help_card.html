{% load i18n %}
{% load static %}

<!-- Collapsible Help Card Component -->
<div class="bg-blue-50 border border-blue-200 rounded-lg mb-6" role="region" aria-labelledby="help-card-title">
    <!-- Header with toggle button -->
    <button 
        class="w-full flex items-center justify-between p-4 text-left hover:bg-blue-100 transition-colors duration-200 rounded-t-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset"
        onclick="toggleHelpCard()"
        aria-expanded="false"
        aria-controls="help-card-content"
        id="help-card-toggle"
    >
        <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
                <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h4 id="help-card-title" class="text-lg font-semibold text-blue-900">{% translate "Help for understanding PRO Results" %}</h4>
        </div>
        <div class="flex-shrink-0">
            <svg id="help-card-chevron" class="w-5 h-5 text-blue-600 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </div>
    </button>
    
    <!-- Collapsible content -->
    <div id="help-card-content" class="hidden" aria-labelledby="help-card-title">
        <div class="px-4 pb-4">
            <div class="flex items-start space-x-3">
                <div class="flex-1">
            
            <div class="text-sm space-y-4">
                
                <!-- Change Indicators - 5 Column Layout -->
                <div>
                    <h5 class="font-medium text-gray-800 mb-2">{% translate "Change Indicators:" %}</h5>
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 text-xs">
                        <div class="flex items-center space-x-1">
                            <c-icon_trending_up class="text-green-600 w-3 h-3" aria-hidden="true" />
                            <span class="text-green-600">{% translate "Improved Score with respect to the previous assessment." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <c-icon_trending_down class="text-green-600 w-3 h-3" aria-hidden="true" />
                            <span class="text-green-600">{% translate "Decreased Score with respect to the previous assessment." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <c-icon_trending_up class="text-orange-500 w-3 h-3" aria-hidden="true" />
                            <span class="text-orange-500">{% translate "Increased Score with respect to the previous assessment." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <c-icon_trending_down class="text-orange-500 w-3 h-3" aria-hidden="true" />
                            <span class="text-orange-500">{% translate "Decreased Score with respect to the previous assessment." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <c-icon_no_change class="text-blue-500 w-3 h-3" aria-hidden="true" />
                            <span class="text-blue-500">{% translate "No change with respect to the previous assessment" %}</span>
                        </div>
                    </div>
                </div>

                <!-- Plot Elements - Full Width -->
                <div>
                    <h5 class="font-medium text-gray-800 mb-2">{% translate "Plot Elements:" %}</h5>
                    <div class="grid grid-cols-1 gap-4 text-xs">
                        <div class="flex items-center space-x-1">
                            <span class="text-blue-600 font-bold" aria-hidden="true">—</span>
                            <span>{% translate "Trend line: This represents the trend of the score over time." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-blue-600 font-bold" aria-hidden="true">●</span>
                            <span>{% translate "Score points: These represent the actual scores for each time point." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-red-600 font-bold" aria-hidden="true">- -</span>
                            <span>{% translate "Threshold: This is the clinical significance threshold. For some constructs, scores above the threshold indicate improvement (e.g., quality of life), while for others, scores below the threshold indicate improvement (e.g., symptom severity)." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-1 bg-red-500 border-dashed border border-red-500 flex-shrink-0" aria-hidden="true"></div>
                            <span>{% translate "Threshold Score: This represents a score which when crossed indicates that the score is abnormal. Typically this is provided for questionnaires related to diseases where symptom burden or functional status is being evaluated. If provided then the score needs to be interpreted keeping in mind the direction of improvement. For example, if the direction of improvement is lower is better then scores ABOVE the threshold scores would be considered clinically significant or pathological." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-1 bg-gray-500 border-dashed border border-gray-500 flex-shrink-0" aria-hidden="true"></div>
                            <span>{% translate "Normative Score: This represents the mean score which is observered in a normal population. Note that this is not available for all questionnaires but for those where the questions are applicable for normal population this score is provided. For example the EORTC QLQ C30 questionnaire can be used across all population types - thus a normative score is available. On the other hand CX24 questionnaire is applicable for the patients with cervical cancer and therefore normative scores are not applicable for the constructs from this questionnaire. " %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-2 bg-gray-300 opacity-50 flex-shrink-0" aria-hidden="true"></div>
                            <span>{% translate "Standard deviation band" %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="flex items-center">
                                <div class="w-1 h-3 bg-blue-500 flex-shrink-0" aria-hidden="true"></div>
                                <div class="w-2 h-1 bg-blue-500 flex-shrink-0" aria-hidden="true"></div>
                                <div class="w-1 h-3 bg-blue-500 flex-shrink-0" aria-hidden="true"></div>
                            </div>
                            <span>{% translate "Error bars (confidence intervals)" %}</span>
                        </div>
                    </div>
                </div>

                <!-- Status Indicators - Single Line -->
                <div>
                    <h5 class="font-medium text-gray-800 mb-2">{% translate "Status Indicators:" %}</h5>
                    <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-xs">
                        <div class="flex items-center space-x-1">
                            <span class="text-green-600 font-bold" aria-hidden="true">✓</span>
                            <span>{% translate "Score Meets threshold" %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-red-600 font-bold" aria-hidden="true">⚠</span>
                            <span>{% translate "Score Below threshold" %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-blue-600 font-bold" aria-hidden="true">◯</span>
                            <span>{% translate "Population mean score value (normative score value)" %}</span>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="mt-4 pt-3 border-t border-blue-200">
                    <p class="text-xs text-blue-700">
                        <strong>{% translate "Format:" %}</strong> {% translate "Items (Questions) answered/Total items" %}
                    </p>
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for collapsible functionality -->
<script>
function toggleHelpCard() {
    const content = document.getElementById('help-card-content');
    const toggle = document.getElementById('help-card-toggle');
    const chevron = document.getElementById('help-card-chevron');
    
    if (content.classList.contains('hidden')) {
        // Show content
        content.classList.remove('hidden');
        toggle.setAttribute('aria-expanded', 'true');
        chevron.classList.add('rotate-180');
    } else {
        // Hide content
        content.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
        chevron.classList.remove('rotate-180');
    }
}

// Optional: Allow keyboard navigation
document.getElementById('help-card-toggle').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleHelpCard();
    }
});
</script>
