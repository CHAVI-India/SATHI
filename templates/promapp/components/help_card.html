{% load i18n %}
{% load static %}

<!-- Collapsible Help Card Component -->
<div class="bg-white border border-gray-200 rounded-lg shadow-sm mb-6" role="region" aria-labelledby="help-card-title">
    <!-- Header with toggle button -->
    <button 
        class="w-full flex items-center justify-between p-4 text-left hover:bg-blue-100 transition-colors duration-200 rounded-t-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset"
        onclick="toggleHelpCard()"
        aria-expanded="false"
        aria-controls="help-card-content"
        id="help-card-toggle"
    >
        <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
                <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h4 id="help-card-title" class="text-lg font-semibold text-blue-900">{% translate "Click here to understand the PRO Results plots and sections" %}</h4>
        </div>
        <div class="flex-shrink-0">
            <svg id="help-card-chevron" class="w-5 h-5 text-blue-600 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </div>
    </button>
    
    <!-- Collapsible content -->
    <div id="help-card-content" class="hidden" aria-labelledby="help-card-title">
        <div class="px-4 pb-4">
            <div class="flex items-start space-x-3">
                <div class="flex-1">
            
            <div class="text-base space-y-4">
                
                <!-- Change Indicators - 5 Column Layout -->
                <div>
                    <h5 class="font-medium text-gray-800 mb-2">{% translate "Change Indicators:" %}</h5>
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 text-sm">
                        <div class="flex items-center space-x-1">
                            <c-icon_trending_up class="text-green-600 w-3 h-3" aria-hidden="true" />
                            <span class="text-green-600">{% translate "Beneficial Improved Score with respect to the previous assessment." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <c-icon_trending_up class="text-orange-500 w-3 h-3" aria-hidden="true" />
                            <span class="text-orange-500">{% translate "Detrimental Increased Score with respect to the previous assessment." %}</span>
                        </div>                        
                        <div class="flex items-center space-x-1">
                            <c-icon_trending_down class="text-green-600 w-3 h-3" aria-hidden="true" />
                            <span class="text-green-600">{% translate "Beneficial Decreased Score with respect to the previous assessment." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <c-icon_trending_down class="text-orange-500 w-3 h-3" aria-hidden="true" />
                            <span class="text-orange-500">{% translate "Detrimental Decreased Score with respect to the previous assessment." %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <c-icon_no_change class="text-blue-500 w-3 h-3" aria-hidden="true" />
                            <span class="text-blue-500">{% translate "No change with respect to the previous assessment" %}</span>
                        </div>
                    </div>
                </div>

                <!-- Plot Elements - Full Width -->
                <div>
                    <h5 class="font-medium text-gray-800 mb-2">{% translate "Plot Elements:" %}</h5>
                    <div class="grid grid-cols-1 gap-4 text-sm">
                        <div class="flex items-center space-x-2">
                            <svg class="w-6 h-6 text-black flex-shrink-0" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M2 12h20"></path>
                            </svg>
                            <span><strong>{% translate "Score line:" %}</strong> {% translate "Scores are represented as a line plot joining the scores at each time point for a given patient." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <svg class="w-6 h-6 text-black flex-shrink-0" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="5"></circle>
                            </svg>
                            <span><strong>{% translate "Points:" %}</strong> {% translate "Black solid circles representing the actual scores for each time point. You can hover over the point to see the actual score value at that specific time point along with the date on which the response was provided." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <svg class="w-6 h-6 text-orange-500 flex-shrink-0" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M2 12h20"></path>
                            </svg>
                            <span><strong>{% translate "Threshold Score Line:" %}</strong> {% translate "This is the clinical significance threshold. For some constructs, scores above the threshold indicate improvement (e.g., quality of life), while for others, scores below the threshold indicate improvement (e.g., symptom severity). This is represented as a straight line in the plot." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <svg class="w-6 h-6 text-gray-500 flex-shrink-0" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M2 12h20"></path>
                            </svg>
                            <span><strong>{% translate "Normative Score Line:" %}</strong> {% translate "This represents the population mean score for the construct. For example, in the EORTC QLQ C30, the normative score for Global Health Status is 61.3, and for the CX24 Symptom Experience, it is 22.1." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <svg class="w-6 h-6 text-gray-400 flex-shrink-0" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24">
                                <rect x="1" y="7" width="22" height="10" opacity="0.5"></rect>
                            </svg>
                            <span><strong>{% translate "Normative score standard deviation bands:" %}</strong> {% translate "Gray shaded bands around the normative score showing population variation." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <svg class="w-6 h-6 text-gray-500 flex-shrink-0" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" stroke-dasharray="6,4" d="M2 12h20"></path>
                            </svg>
                            <span><strong>{% translate "Aggregated score line plot:" %}</strong> {% translate "Dashed gray lines representing scores from other similar patients in the system used to generate the aggregated line plot. These are patient responses for the same construct and have been calculated to ensure that time intervals match. For example data of all patients who have responded at three months from their start of treamtent will be aggregated together irrespective of the actual start dates. You can select the type of date to limit the aggregation further in the filters section above. Doing this will ensure that data of patients who have that particular date type available are used for the calculation. For example, if you choose start date of adjuvant radiotherapy then data will only have patients who have started on adjuvant radiotherapy and data of other patients will be excluded from calculation of the aggregated line plot." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <svg class="w-6 h-6 text-gray-600 flex-shrink-0" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m0-8h8m-8 0H4"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 8h8M8 16h8"></path>
                            </svg>
                            <span><strong>{% translate "Error bars:" %}</strong> {% translate "Gray colored bars around the aggregated score curve showing error bars. These error bars can represent the standard deviation, interquartile range or 95% confidence intervals of the mean as per your choice and will be calculated after you select the corresponding option in the filter section above." %}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <svg class="w-6 h-6 text-green-600 flex-shrink-0" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" stroke-dasharray="4,3" d="M12 2v20"></path>
                            </svg>
                            <span><strong>{% translate "Treatment and diagnosis date indicators:" %}</strong> {% translate "Dashed vertical lines indicating important medical events if selected by clicking the checkboxes in the patient information section below." %}</span>
                        </div>
                    </div>
                </div>

                <!-- Status Indicators - Single Line -->
                <div>
                    <h5 class="font-medium text-gray-800 mb-2">{% translate "Status Indicators:" %}</h5>
                    <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-sm">
                        <div class="flex items-center space-x-1">
                            <span class="text-green-600 font-bold" aria-hidden="true">✓</span>
                            <span>{% translate "Score Meets threshold" %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-red-600 font-bold" aria-hidden="true">⚠</span>
                            <span>{% translate "Score Below threshold" %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-blue-600 font-bold" aria-hidden="true">◯</span>
                            <span>{% translate "Population mean score value (normative score value)" %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700">{% translate "Higher is Better" %}</span>
                            <span>{% translate "Improvement direction: Higher scores indicate better outcomes" %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-700">{% translate "Lower is Better" %}</span>
                            <span>{% translate "Improvement direction: Lower scores indicate better outcomes" %}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-700">{% translate "Middle is Better" %}</span>
                            <span>{% translate "Improvement direction: Scores closer to middle range indicate better outcomes. The color of this line changes based on the type of date being selected." %}</span>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="mt-4 pt-3 border-t border-gray-200">
                    <p class="text-sm text-blue-700">
                        <strong>{% translate "Format:" %}</strong> {% translate "Items (Questions) answered/Total items" %}
                    </p>
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for collapsible functionality -->
<script>
function toggleHelpCard() {
    const content = document.getElementById('help-card-content');
    const toggle = document.getElementById('help-card-toggle');
    const chevron = document.getElementById('help-card-chevron');
    
    if (content.classList.contains('hidden')) {
        // Show content
        content.classList.remove('hidden');
        toggle.setAttribute('aria-expanded', 'true');
        chevron.classList.add('rotate-180');
    } else {
        // Hide content
        content.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
        chevron.classList.remove('rotate-180');
    }
}

// Optional: Allow keyboard navigation
document.getElementById('help-card-toggle').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleHelpCard();
    }
});
</script>
